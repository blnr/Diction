<% provide(:title, "Search") %>

<!--
<nav role="dashboard-nav">
    <span class="text"><img class="search-glass" src="search-icon.png"></span>
    <span class="text">Filter-By <span class="nav-arrow-up"></span></span>
    <span class="text">Sort-By <span class="nav-arrow-up"></span></span>
    <span class="text">Lists <span class="nav-arrow-up"></span></span>
</nav>
-->
    

<div id="search-results">

    <% # Loop through word elements %>
    <% @word.each do |element|  %>

    <% # set audio element attached to word %>
    <% audio = element["primaries"][0]["terms"][2]["text"] %>

        <div class="word-container">
           
            <section class="top-container">
                <p class="word" onclick="playSound(this, '<%= audio %>');">
                                            <%= element["primaries"][0]["terms"][0]["text"] %></p>
                <p class="speech">          <%= element["primaries"][0]["terms"][0]["labels"][0]["text"] %></p>
            </section>
                
            <section class="definition-container">
                <ol>
                    <% # Set nil definition for first evaluation %>
                    <% previous = nil %> 
                      
                      <% # Loop through definitions (first two) %>
                      <% element["primaries"][0]["entries"].first(3).each do |word| %>
                        
                        <%  # Set definition and example variables %>
                        <%  definition = word["terms"][0]["text"] %>
                        <%  example    = word["entries"][0]["terms"][0]["text"] rescue false %>

                          <% # Ensure definition exists and is not the same as first %>
                          <% if (definition rescue false) != false && definition != previous %>
                             <li role="definition"> <%= definition %> </li>
                          <% end %>

                              <% # Display Example %>
                              <% if (example rescue false) != false %>
                                <% example.gsub!('x3cemx3e', '').gsub!('x3c/emx3e', '') %>
                                <p class="example">"<%= example %>"</p>
                              <% end %>

                        <% # Variable to hold first definition (for next evaluation) %>
                        <% previous = element["primaries"][0]["entries"][0]["terms"][0]["text"] %>

                    <% end%> 
                </ol>
            </section>
                <span class="extra-information"></span>               

        </div>

    <% end %>
    <% # End loop %> 

</div>


<!-- javascript -->
<script>
    // remove header drop effect
    $('header#home-drop').removeAttr('id');

    // audio for words searched
    function playSound(el,soundfile) {
        var embed = document.getElementById("embed");
        if (!embed) {
            var embed = document.createElement("embed");
                embed.id= "embed";
                embed.setAttribute("src", soundfile);
                embed.setAttribute("hidden", "true");
            el.appendChild(embed);
        } else {
            embed.parentNode.removeChild(embed);
        }
    }
</script>